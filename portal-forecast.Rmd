---
title: "Portal Forecast"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Total Abundance Forecast

This is the forecast for next month's sampling of rodents at Portal.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
source('forecast-viz.R', echo = FALSE)
obs = download_observations()
source('https://raw.githubusercontent.com/weecology/PortalDataSummaries/master/RodentAbundances.R', echo = FALSE)
obs_data = abundance()
obs_data$total = rowSums(select(obs_data, -period))
new_moons = read.csv('~/PortalData/Rodents/moon_dates.csv')
obs_data_newmoon = inner_join(obs_data, new_moons, by = c("period" = "Period"))
for_data = read.csv("predictions/2016-8-31Allforecasts.csv")

forecast_viz(obs_data = obs_data_newmoon,
             obs_date_col_name = "NewMoonNumber",
             obs_val_col_name = "total",
             for_data = for_data,
             for_date_col_name = "NewMoonNumber",
             for_val_col_name = "estimate",
             for_model_name = "NegBinom Time Series",
             for_lowerpi_col_name = "LowerPI",
             for_upperpi_col_name = "UpperPI",
             start_newmoon = 300)
```

## Species-Level Forecasts

```{r speciesforecasts, echo=FALSE, message=FALSE, warning=FALSE}
source("forecast-viz.R")
source("forecast_tools.R")
source("actual_census_counts.R")
source("https://raw.githubusercontent.com/weecology/PortalDataSummaries/master/RodentAbundances.R")

data = compile_forecasts()
ensemble = make_ensemble(data)
plot_sp_predicts(ensemble, 'All', lead_time = 1)
```
